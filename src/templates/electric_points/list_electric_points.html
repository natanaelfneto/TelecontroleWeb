{% extends 'common/list.html' %}
{% load staticfiles %}
{% load i18n %}
{% load get_active_location %}
{% load has_project %}

{% block scripts %}        
<script>
    function passDataToModal(url) {
        document.getElementById('modal-submit-button').href = url;
    }
</script>
{% endblock scripts %}

{% block list_add_new %}
{% if request.user.is_admin or request.user.is_planner %}
<div>
    <a
        href="{% url 'electric_points:addElectricPoint' %}" 
        class="btn btn-outline-primary" 
        data-toggle="block-option">
        <i class="si si-plus"></i>
        <span>Adicionar {{ page_title }}</span>
    </a>
</div>
{% endif %}  
{% endblock list_add_new %}

{% block search_list_block %}            
<form 
    class="d-none d-sm-inline-block w-25 ml-auto" 
    action="{% url 'electric_points:listElectricPoints' %}"
    method="POST">{% csrf_token %}
    <div class="input-group input-group-sm">
        <input 
            type="text" 
            class="form-control form-control-alt bg-light" 
            placeholder="Pesquisar poste indicado.." 
            id="search_list" 
            name="searched_list_name">
        <div class="input-group-append">
            <span class="input-group-text bg-body border-0">
                <i class="si si-magnifier"></i>
            </span>
        </div>
    </div>
</form>
{% endblock search_list_block %}

{% block list_head %}
<thead>
    <tr class="text-uppercase">
        <!-- <th class="font-w700">ID</th> -->
        <th class="d-sm-table-cell font-w700" style="max-width: 120px;">Ponte Indicado</th>
        <th class="d-sm-table-cell font-w700" style="max-width: 120px;">Ponto Projetado</th>
        <th class="font-w700 align-middle" style="max-width: 120px;">Alimentador</th>
        <th class="font-w700 align-middle">
            <span style="position: relative; left: 4rem;">Localização</span>
        </th>
        <th class="font-w700 align-middle"></th>
        <th class="font-w700 align-middle">Cadastrado em</th>
        <th class="font-w700 align-middle">Cadastrado por</th>
        <th class="font-w700 text-center" style="width: 40px;"></th>
        <th class="font-w700 text-center" style="width: 40px;"></th>
        <th class="font-w700 text-center" style="width: 40px;"></th>
    </tr>
</thead>
{% endblock list_head %}

{% block list_body %}
<tbody>
    {% for electric_point in object_list %}
    <tr>
        <!-- <td><span class="font-w600">{{ electric_point.id }}</span></td> -->
        <td class="d-none d-sm-table-cell">
            <span class="font-size-sm text-muted">
                {{ electric_point.name }}
            </span>
        </td>
        <td class="d-none d-sm-table-cell">
            <span class="font-size-sm text-muted">
                {{ electric_point.id|get_active_location:'related_electric_point_name' }}
            </span>
        </td>
        <td class="d-none d-sm-table-cell">
            <span class="font-size-sm text-muted">
                {{ electric_point.feeder.name }}
            </span>
        </td>
        <td class="d-none d-sm-table-cell" style="min-width: 10rem;">
            <div class="font-size-sm text-muted" style="max-width: 10rem;">
                <span class="font-w600">Latitude:</span>
                <span class="float-right">
                    {{ electric_point.locations|get_active_location:'latitude' }}
                </span>
            </div>
            <div class="font-size-sm text-muted" style="max-width: 10rem;">
                <span class="font-w600">Longitude:</span>
                <span class="float-right">
                    {{ electric_point.locations|get_active_location:'longitude' }}
                </span>
            </div>
        </td>
        <td class="d-none d-sm-table-cell">
            <div class="font-size-sm text-muted text-center" style="max-width: 10rem;">
                <i class="si si-pointer"></i>
                <span>{{ electric_point.locations|get_active_location:'get_city_display' }}</span>,
                <span>{{ electric_point.locations|get_active_location:'get_state_display' }}</span>
                <span>({{ electric_point.locations|get_active_location:'state' }})</span>
            </div>
        </td>
        <td class="d-none d-sm-table-cell">
            <span class="font-size-sm text-muted">
                {% language 'pt' %}
                {{ electric_point.created_at|date:"D, d \d\e F \d\e Y" }}
                {% endlanguage %}
            </span>
        </td>
        <td class="d-none d-sm-table-cell">
            <a
                class="link-fx" 
                href="{% url 'accounts:detailUser' electric_point.created_by.id %}">
                <span class="font-size-sm text-muted">
                    {{ electric_point.created_by.get_full_name }}
                </span>
            </a>
        </td>
        {% if not electric_point|has_project %}
            {% if request.user.is_admin or request.user.is_designer %}
            <td class="text-center">
                <a href="{% url 'electric_points:addProjectToElectricPoint' electric_point.id %}">
                    <i class="si si-plus text-success"></i>
                </a>
            </td>
            {% else %}
            <td class="text-center">
                <a
                    href=""
                    data-toggle="modal" 
                    data-target="#modal-cannot-create-project-popout">
                    <i class="si si-plus text-success"></i>
                </a>
            </td>
            {% endif %}
        {% else %}
        <td class="text-center">
            <a href="{% url 'electric_points:findProjectForElectricPoint' electric_point.id %}">
                <i class="si si-info text-info"></i>
            </a>
        </td>
        {% endif %}
        {% if not electric_point|has_project %}
        <td class="text-center">
            <a href="{% url 'electric_points:updateElectricPoint' electric_point.id %}">
                <i class="si si-note text-secondary"></i>
            </a>
        </td>
        {% else %}
        <td class="text-center">
            <a 
                href=""
                data-toggle="modal" 
                data-target="#modal-cannot-delete-popout">
                <i class="si si-note text-secondary"></i>
            </a>
        </td>
        {% endif %}
        {% if not electric_point|has_project %}
        <td class="text-center">
            <a
                href="#"
                target="{% url 'electric_points:deleteElectricPoint' electric_point.id %}"
                onclick="passDataToModal(this.getAttribute('target'))"
                data-toggle="modal" 
                data-target="#modal-delete-popout">
                <i class="si si-close text-danger"></i>
            </a>
        </td>
        {% else %}
        <td class="text-center">
            <a
                href="#"
                data-toggle="modal" 
                data-target="#modal-cannot-delete-popout">
                <i class="si si-close text-danger"></i>
            </a>
        </td>
        {% endif %}
    </tr>
    {% endfor %}
</tbody>

{% include 'electric_points/modals/cannot_delete_modal.html' %}

{% include 'electric_points/modals/cannot_create_project_modal.html' %}

{% endblock list_body %}
