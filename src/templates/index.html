{% extends 'base.html' %}
{% load staticfiles %}
{% load mathfilters %}
{% load decimal_filter %}
{% block scripts %}
{% endblock scripts %}
{% block content %}
<!-- Main Container -->
<main id="main-container">
    <!-- Hero -->
    {% include 'common/page_navigation_head.html' %}
    <!-- END Hero -->
    <!-- Page Content -->
    <div class="content content-narrow">
        <!-- Stats -->
        <div>
            <form 
                id="project_progress_status_filter_form"
                class="d-none" 
                action="{% url 'projects:listProjects' %}" 
                method="POST">{% csrf_token %}
                <input 
                    type="submit" 
                    class="d-none"
                    name="project_progress_status_filter"
                    value="" />
            </form>
            <script>
                function callFilteredProjectList(target) {
                    $('input[name="project_progress_status_filter"]').val(target).click();
                }
            </script>
            <style>
                #progress_status_cards > div:hover > a:first-child {
                    display: none;
                }
                #progress_status_cards > div:hover > a:first-child ~ a:nth-child(2) {
                    display: block;
                }
                #progress_status_cards > div > a:nth-child(2) {
                    display: none;
                }
            </style>
            <div id="progress_status_cards" class="row">
                <div class="col-6 col-md-2 col-lg-6 col-xl-2" style="max-height: 0;">
                    <a 
                        class="block block-rounded block-link-pop border-left border-info border-4x"
                        href="javascript:void(0)"
                        target="A projetar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-info"><small>A projetar</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.designing }}
                                <small><small>/ {{ models.electric_points.designing }}</small></small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-info border-4x"
                        href="javascript:void(0)"
                        target="A projetar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-info">
                                    {{ models.electric_points.designing|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.designing }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.designing|div:models.projects.designing|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-md-2 col-lg-6 col-xl-2">
                    <a 
                        class="block block-rounded block-link-pop border-left border-secondary border-4x" 
                        href="javascript:void(0)"
                        target="A instalar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-secondary"><small>A instalar</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.installation }}
                                <small>
                                    /<small class="text-secondary">
                                    {{ models.electric_points.installation }}
                                    </small>
                                </small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-secondary border-4x"
                        href="javascript:void(0)"
                        target="A instalar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-secondary">
                                    {{ models.electric_points.installation|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.installation }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.installation|div:models.projects.installation|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-md-2 col-lg-6 col-xl-2">
                    <a 
                        class="block block-rounded block-link-pop border-left border-warning border-4x" 
                        href="javascript:void(0)"
                        target="A energizar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-warning"><small>A energizar</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.energizing }}
                                <small>
                                    /<small class="text-secondary">
                                    {{ models.electric_points.energizing }}
                                    </small>
                                </small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-warning border-4x" 
                        href="javascript:void(0)"
                        target="A energizar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-warning">
                                    {{ models.electric_points.energizing|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.energizing }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.energizing|div:models.projects.energizing|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-md-2 col-lg-6 col-xl-2">
                    <a 
                        class="block block-rounded block-link-pop border-left border-primary border-4x" 
                        href="javascript:void(0)"
                        target="A comissionar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-primary"><small>A comissionar</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.commissioning }}
                                <small>
                                    /<small class="text-secondary">
                                    {{ models.electric_points.commissioning }}
                                    </small>
                                </small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-primary border-4x" 
                        href="javascript:void(0)"
                        target="A comissionar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-primary">
                                    {{ models.electric_points.commissioning|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.commissioning }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.commissioning|div:models.projects.commissioning|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-md-2 col-lg-6 col-xl-2">
                    <a 
                        class="block block-rounded block-link-pop border-left border-dark border-4x" 
                        href="javascript:void(0)"
                        target="A operar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-dark"><small>A operar</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.operation }}
                                <small>
                                    /<small class="text-secondary">
                                    {{ models.electric_points.operation }}
                                    </small>
                                </small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-dark border-4x" 
                        href="javascript:void(0)"
                        target="A operar"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-dark">
                                    {{ models.electric_points.operation|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.operation }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.operation|div:models.projects.operation|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-6 col-md-2 col-lg-6 col-xl-2">
                    <a 
                        class="block block-rounded block-link-pop border-left border-success border-4x" 
                        href="javascript:void(0)"
                        target="Concluído"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Pontos Elétricos</small>
                                <div class="text-success"><small>Concluídos</small></div>
                            </div>
                            <div 
                                class="font-size-h2 font-w400 text-dark text-right">
                                {{ models.projects.finished }}
                                <small>
                                    /<small class="text-secondary">
                                    {{ models.electric_points.finished }}
                                    </small>
                                </small>
                            </div>
                        </div>
                    </a>
                    <a 
                        class="block block-rounded block-link-pop border-left border-success border-4x" 
                        href="javascript:void(0)"
                        target="Concluído"
                        onclick="callFilteredProjectList(this.getAttribute('target'))">
                        <div class="block-content block-content-full">
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Avanço em</small>
                                <div class="text-success">
                                    {{ models.electric_points.finished|div:models.projects.total|mul:100|decimal_filter }}
                                    <span>%</span>
                                    <span class="text-dark">
                                        ({{ models.electric_points.finished }})
                                    </span>
                                </div>
                            </div>
                            <div 
                                class="font-size-sm font-w600 text-uppercase">
                                <small class="text-muted">Com pendências</small>
                                <div class="text-danger">
                                    {{ models.pendencies.finished|div:models.projects.finished|mul:100|decimal_filter }}
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <!-- END Stats -->
        <!-- Dashboard Charts -->
         <div class="row">
            <div class="col-lg-6">
                <div class="block block-rounded block-mode-loading-oneui">
                    <div class="block-header">
                        <h3 class="block-title">Progresso de Projetos</h3>
                        <div class="block-options"></div>
                    </div>
                    <div class="block-content p-0 bg-body-light text-center">
                        <div class="pt-3">
                            <canvas id="progressStatusChart"></canvas>
                            <script>
                            var ctx = document.getElementById('progressStatusChart').getContext('2d');
                            var progressStatusChart = new Chart(ctx, {
                                type: 'horizontalBar',
                                data: {
                                    labels: [
                                        'A projetar', 
                                        'A instalar', 
                                        'A energizar', 
                                        'A comissionar', 
                                        'A operar', 
                                        'Concluído'
                                    ],
                                    datasets: [{
                                        data: [
                                        '{{ models.projects.designing }}',
                                        '{{ models.projects.installation }}',
                                        '{{ models.projects.energizing }}',
                                        '{{ models.projects.commissioning }}',
                                        '{{ models.projects.operation }}',
                                        '{{ models.projects.finished }}'
                                        ],
                                        backgroundColor: [
                                            '#4EA9E6',
                                            '#5A6268',
                                            '#F0A73C',
                                            '#3E69C9',
                                            '#23272B',
                                            '#38AB69'
                                        ],
                                        borderColor: [
                                            '#4EA9E6',
                                            '#5A6268',
                                            '#F0A73C',
                                            '#3E69C9',
                                            '#23272B',
                                            '#38AB69'
                                        ],
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    legend: {
                                        display: false
                                    },
                                    scales: {
                                        xAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                precision: 1,
                                            }
                                        }],
                                    }
                                }
                            });
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="block block-rounded block-mode-loading-oneui">
                    <div class="block-header">
                        <h3 class="block-title">Projetos por Regional</h3>
                        <div class="block-options"></div>
                    </div>
                    <div class="block-content p-0 bg-body-light text-center">
                        <div class="pt-3">
                            <canvas id="projectsByRegionChart"></canvas>
                            <script>
                            var ctx = document.getElementById('projectsByRegionChart').getContext('2d');
                            var projectsByRegionChart = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: [
                                        {% for name in models.feeders.electric_regions.names %}
                                        '{{ name.electric_region }}',
                                        {% endfor %}
                                    ],
                                    datasets: [
                                        {% for progress_status, values in models.feeders.electric_regions.count.items %}
                                        {
                                            label: '{{ progress_status }}',
                                            data: [
                                                {% for region, value in values.items %}
                                                '{{ value }}',
                                                {% endfor %}
                                            ],
                                            {% if progress_status == 'A projetar' %}
                                                backgroundColor: [
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                ],
                                                borderColor: [
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                    '#4EA9E6', '#4EA9E6', '#4EA9E6',
                                                ],
                                            {% elif progress_status == 'A instalar' %}
                                                backgroundColor: [
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                ],
                                                borderColor: [
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                    '#5A6268', '#5A6268', '#5A6268',
                                                ],
                                            {% elif progress_status == 'A energizar' %}
                                                backgroundColor: [
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                ],
                                                borderColor: [
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                    '#F0A73C', '#F0A73C', '#F0A73C',
                                                ],
                                            {% elif progress_status == 'A comissionar' %}
                                                backgroundColor: [
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                ],
                                                borderColor: [
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                    '#3E69C9', '#3E69C9', '#3E69C9',
                                                ],
                                            {% elif progress_status == 'A operar' %}
                                                backgroundColor: [
                                                    '#23272B', '#23272B', '#23272B',
                                                    '#23272B', '#23272B', '#23272B',
                                                    '#23272B', '#23272B', '#23272B',
                                                ],
                                                borderColor: [
                                                    '#23272B', '#23272B', '#23272B',
                                                    '#23272B', '#23272B', '#23272B',
                                                    '#23272B', '#23272B', '#23272B',
                                                ],
                                            {% elif progress_status == 'Concluído' %}
                                                backgroundColor: [
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                ],
                                                borderColor: [
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                    '#38AB69', '#38AB69', '#38AB69',
                                                ],
                                            {% endif %}
                                            borderWidth: 1
                                        },
                                        {% endfor %}
                                    ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                precision: 1,
                                            }
                                        }],
                                    }
                                }
                            });
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div> 
        <!-- END Dashboard Charts -->
    </div>
    <!-- END Page Content -->
</main>
<!-- END Main Container -->
{% endblock content %}